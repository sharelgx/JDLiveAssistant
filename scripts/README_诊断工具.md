# 页面诊断工具使用说明

## 功能说明

这个诊断工具用于分析京东直播后台页面结构，帮助定位为什么软件无法找到商品元素。

## 使用方法

### 方法一：双击运行（Windows）

1. 确保浏览器已经以调试模式启动（端口 9222）
2. 打开京东直播后台的商品管理页面
3. 双击运行 `scripts/diagnose_page.bat`
4. 查看诊断结果

### 方法二：命令行运行

```bash
# 激活虚拟环境
venv\Scripts\activate

# 运行诊断工具（默认端口 9222）
python scripts/diagnose_page.py

# 或指定其他端口
python scripts/diagnose_page.py 9223
```

## 诊断输出说明

诊断工具会输出以下信息：

### 1. 基本页面信息
- URL 和标题
- 页面加载状态（readyState）
- body 元素状态和内容长度

### 2. 框架信息
- iframe 数量和详情
- 帮助判断商品列表是否在 iframe 中

### 3. 表格相关元素
- 表格数量
- tbody 数量
- **tr.ant-table-row 数量**（这是关键！）

### 4. 商品容器相关元素
- skuContainer 数量
- wrapper 数量
- 包含 'goods' 和 'sku' 的元素数量

### 5. "讲解"按钮信息
- **"讲解"按钮总数**（这是关键！）
- 每个按钮的详细信息：
  - 标签类型
  - 文本内容
  - CSS 类名
  - 是否可见
  - 页面位置

### 6. "讲解"按钮的父容器层级结构
- 显示按钮的父元素层级关系
- 帮助找到正确的商品容器选择器

### 7. 第一个 TR 的 HTML 片段
- 显示实际的 HTML 结构
- 便于对比和分析

### 8. 诊断建议
- 根据检测结果给出问题诊断和建议

## 输出文件

诊断结果会保存到：
- `scripts/page_diagnosis_result.json` - 完整的 JSON 格式诊断数据

## 常见问题诊断

### 问题 1: 没有找到"讲解"按钮
**可能原因：**
- 浏览器没有打开京东直播后台页面
- 页面还在加载中
- 页面结构已完全改变

**解决方法：**
1. 确认浏览器打开的是正确的页面
2. 等待页面完全加载后再运行诊断
3. 尝试刷新页面

### 问题 2: 找到"讲解"按钮，但没有 tr.ant-table-row
**可能原因：**
- 页面结构已改变，不再使用表格布局
- 商品列表在 iframe 中

**解决方法：**
1. 查看"讲解按钮的父容器层级结构"部分
2. 找到包含商品的实际容器元素
3. 更新软件中的选择器

### 问题 3: 找到了元素但软件还是不工作
**可能原因：**
- 元素在不可见的 iframe 中
- 元素被遮挡或隐藏
- 页面使用了动态加载

**解决方法：**
1. 查看"框架信息"，确认是否有 iframe
2. 检查按钮的"可见"状态和位置
3. 可能需要在软件中添加等待或切换 frame 的逻辑

## 如何将诊断结果反馈给开发者

如果问题仍然无法解决，请：

1. 运行诊断工具
2. 截图保存完整的诊断输出
3. 将 `scripts/page_diagnosis_result.json` 文件发送给开发者
4. 说明当前的软件版本和浏览器版本

## 注意事项

- 运行诊断工具前，确保浏览器已经以调试模式启动
- 确保打开的是京东直播后台的商品管理页面
- 如果页面还在加载中，等待几秒后再运行
- 诊断工具不会修改任何页面内容，只是读取页面信息

